import{_ as s,c as a,d as t,o as p}from"./app-CLBzsk86.js";const e={};function o(i,n){return p(),a("div",null,[...n[0]||(n[0]=[t(`<h1 id="ä»-ç‰ˆæœ¬å·æ‰“æ¶-åˆ°-30-ç§’å†…æé†’ç”¨æˆ·åˆ·æ–°-ä¸€ä¸ªå¾®å‰ç«¯å›¢é˜Ÿçš„å®è·µ" tabindex="-1"><a class="header-anchor" href="#ä»-ç‰ˆæœ¬å·æ‰“æ¶-åˆ°-30-ç§’å†…æé†’ç”¨æˆ·åˆ·æ–°-ä¸€ä¸ªå¾®å‰ç«¯å›¢é˜Ÿçš„å®è·µ"><span>ä»&quot;ç‰ˆæœ¬å·æ‰“æ¶&quot;åˆ° 30 ç§’å†…æé†’ç”¨æˆ·åˆ·æ–°ï¼šä¸€ä¸ªå¾®å‰ç«¯å›¢é˜Ÿçš„å®è·µ</span></a></h1><h2 id="_1-èƒŒæ™¯ä¸ç—›ç‚¹" tabindex="-1"><a class="header-anchor" href="#_1-èƒŒæ™¯ä¸ç—›ç‚¹"><span>1. èƒŒæ™¯ä¸ç—›ç‚¹</span></a></h2><p>æˆ‘ä»¬å›¢é˜Ÿç»´æŠ¤ç€ä¸€ä¸ªå¾®å‰ç«¯å­åº”ç”¨é›†ç¾¤ï¼Œæ¯ä¸ªå­åº”ç”¨éƒ½éœ€è¦åŒæ—¶æœåŠ¡ dev / test / release / online å¤šå¥—ç¯å¢ƒã€‚åˆ†æ”¯ç­–ç•¥ï¼ˆmaster / release / test / dev / hotfix / feature_x.x.xï¼‰åŠ ä¸Š Jenkins è‡ªåŠ¨åŒ–ï¼Œè®©&quot;ä¸€å¤©å¤šæ¬¡å‘å¸ƒ&quot;æˆä¸ºå¸¸æ€ã€‚ä½†çœŸæ­£å½±å“äº¤ä»˜æ•ˆç‡çš„å¹¶ä¸æ˜¯å‘å¸ƒæ¬¡æ•°ï¼Œè€Œæ˜¯ä¸€ä¸ªé¡½å›ºçš„é—®é¢˜ï¼š<strong>æµ‹è¯•åŒå­¦å¸¸å¹´åœç•™åœ¨æ—§ç‰ˆæœ¬é¡µé¢</strong>ã€‚</p><h3 id="_1-1-çœŸå®åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#_1-1-çœŸå®åœºæ™¯"><span>1.1 çœŸå®åœºæ™¯</span></a></h3><ul><li>æµ‹è¯•åœ¨æ—©ä¸Šæ‰“å¼€ dev é¡µé¢ï¼Œä¸‹åˆæˆ‘ä»¬å‘å¸ƒäº†æ–°çš„ç»„ä»¶æ ·å¼ï¼›</li><li>ä»–ä»¬ç»§ç»­åœ¨æ—§é¡µé¢é‡Œå›å½’ï¼Œåé¦ˆçš„é—®é¢˜æˆ‘ä»¬ä¸€çœ¼çœ‹å‡º&quot;è¿™æ˜¯è€ç‰ˆæœ¬&quot;ï¼›</li><li>ç¾¤é‡Œå–Š&quot;åˆ·æ–°ä¸€ä¸‹&quot;å¹¶ä¸é è°±ï¼Œäºæ˜¯&quot;æ— æ•ˆç¼ºé™· + åå¤æ²Ÿé€š&quot;æˆäº†å¸¸æ€ã€‚</li></ul><p>æ›´ä¸¥é‡çš„ä¸€æ¬¡äº‹æ•…ï¼Œæ˜¯æˆ‘ä»¬åœ¨ç‰ˆæœ¬æ£€æŸ¥é€»è¾‘é‡ŒåŒæ—¶ä½¿ç”¨äº† webpack DefinePlugin ä¸è‡ªå®šä¹‰æ’ä»¶ï¼Œå„è‡ªè°ƒç”¨äº†ä¸€æ¬¡ <code>getAppVersion()</code>ã€‚ç»“æœå‰ç«¯æ§åˆ¶å°æ‰“å°çš„æ˜¯ <code>0.8.3-release-202511210828</code>ï¼Œè€Œ <code>version.json</code> é‡Œæ˜¯ <code>0.8.3-release-202511210829</code>ã€‚ä¸¤è¾¹åªå·® 1 ç§’é’Ÿï¼Œå´è®©çº¿ä¸Šç”¨æˆ·å§‹ç»ˆè¢«æç¤ºåˆ·æ–°ï¼Œå½¢è±¡åœ°è¢«å›¢é˜Ÿç§°ä¸º&quot;ç‰ˆæœ¬å·æ‰“æ¶&quot;ã€‚</p><h3 id="_1-2-æˆ‘ä»¬çš„è¯‰æ±‚" tabindex="-1"><a class="header-anchor" href="#_1-2-æˆ‘ä»¬çš„è¯‰æ±‚"><span>1.2 æˆ‘ä»¬çš„è¯‰æ±‚</span></a></h3><ol><li>ç”¨æˆ·åœ¨ 30 ç§’å†…æ„ŸçŸ¥ç‰ˆæœ¬æ›´æ–°ï¼›</li><li>å¼¹çª—é‡Œèƒ½çœ‹åˆ°&quot;å½“å‰ç‰ˆæœ¬ / æœ€æ–°ç‰ˆæœ¬ / ç¯å¢ƒ&quot;ï¼›</li><li>æ”¯æŒ&quot;ç«‹å³åˆ·æ–° / ç¨åå†è¯´&quot;ï¼Œä¸ç»™ç”¨æˆ·é€ æˆä¸­æ–­ï¼›</li><li>æ–¹æ¡ˆéœ€å…¼å®¹ç°æœ‰å¾®å‰ç«¯æ¶æ„ä¸ CI/CD æµç¨‹ï¼Œä¸ä¾èµ–åç«¯æ”¹é€ ã€‚</li></ol><h2 id="_2-æ–¹æ¡ˆæ¢ç´¢ä¸å–èˆ" tabindex="-1"><a class="header-anchor" href="#_2-æ–¹æ¡ˆæ¢ç´¢ä¸å–èˆ"><span>2. æ–¹æ¡ˆæ¢ç´¢ä¸å–èˆ</span></a></h2><p>åœ¨åŠ¨æ‰‹å‰ï¼Œæˆ‘ä»¬åˆ—å‡ºå‡ ç§å¯è¡Œæ–¹å¼ï¼š</p><table><thead><tr><th>æ–¹æ¡ˆ</th><th>å®ç°å¤æ‚åº¦</th><th>å®æ—¶æ€§</th><th>ä¾èµ–</th><th>é€‚é…åœºæ™¯</th><th>å…³é”®ä¼˜ç¼ºç‚¹</th></tr></thead><tbody><tr><td>çº¯å‰ç«¯è½®è¯¢ version.json</td><td>ä½</td><td>ä¸­ï¼ˆ30sï¼‰</td><td>å‰ç«¯ + Nginx</td><td>å¤šç¯å¢ƒå¾®å‰ç«¯</td><td>æˆæœ¬æœ€ä½ï¼›è½»å¾®ç½‘ç»œå¼€é”€</td></tr><tr><td>Service Worker/PWA</td><td>ä¸­</td><td>è¾ƒé«˜</td><td>ç°ä»£æµè§ˆå™¨</td><td>PWA åº”ç”¨</td><td>ç¼“å­˜æ§åˆ¶å¥½ï¼Œä½†æ”¹é€ é‡å¤§</td></tr><tr><td>WebSocket æ¨é€</td><td>é«˜</td><td>æœ€é«˜</td><td>åç«¯æœåŠ¡</td><td>å¼ºå®æ—¶åœºæ™¯</td><td>éœ€è¦é¢å¤–æœåŠ¡ç«¯å¼€å‘</td></tr><tr><td>åç«¯æ¥å£ç»Ÿä¸€ç®¡ç†</td><td>ä¸­</td><td>ä¸­</td><td>å‰åç«¯</td><td>ç‰ˆæœ¬é›†ä¸­ç®¡ç†</td><td>å¸¦æ¥è·¨å›¢é˜Ÿè€¦åˆ</td></tr></tbody></table><p>ç»¼åˆå›¢é˜Ÿèµ„æºä¸è½åœ°é€Ÿåº¦ï¼Œæˆ‘ä»¬é€‰æ‹©äº† <strong>çº¯å‰ç«¯è½®è¯¢ + é™æ€ç‰ˆæœ¬æ–‡ä»¶</strong> çš„åšæ³•ï¼Œå¹¶æ˜ç¡®ä¸¤ä¸ªåŸåˆ™ï¼š</p><ul><li><strong>ç‰ˆæœ¬å·å”¯ä¸€ï¼Œå¯è¿½æº¯</strong>ï¼š<code>åŸºç¡€ç‰ˆæœ¬å·-ç¯å¢ƒ-æ—¶é—´æˆ³</code>ï¼›</li><li><strong>å‘å¸ƒé›¶ä¾µå…¥</strong>ï¼šJenkins ä»æ—§è¿è¡Œ <code>npm run build-xxx</code>ï¼Œæ— éœ€æ–°å¢æ­¥éª¤ã€‚</li></ul><h2 id="_3-æŠ€æœ¯æ–¹æ¡ˆæ€»è§ˆ" tabindex="-1"><a class="header-anchor" href="#_3-æŠ€æœ¯æ–¹æ¡ˆæ€»è§ˆ"><span>3. æŠ€æœ¯æ–¹æ¡ˆæ€»è§ˆ</span></a></h2><ol><li><strong>æ„å»ºé˜¶æ®µç”Ÿæˆ version.json</strong>ï¼šåœ¨ <code>vue.config.js</code> ä¸­æå‰è®¡ç®—ç‰ˆæœ¬å·ï¼Œæ—¢æ³¨å…¥åˆ°å‰ç«¯ï¼ˆ<code>process.env.APP_VERSION</code>ï¼‰ï¼Œä¹Ÿå†™å…¥è¾“å‡ºç›®å½•çš„ <code>version.json</code>ï¼›</li><li><strong>å‰ç«¯è½®è¯¢æ¯”å¯¹</strong>ï¼šåº”ç”¨å¯åŠ¨åæ¯ 30 ç§’è¯·æ±‚ä¸€æ¬¡ <code>version.json</code>ï¼Œç¦ç”¨ç¼“å­˜å¹¶æºå¸¦æ—¶é—´æˆ³ï¼Œæ¯”è¾ƒç‰ˆæœ¬å·ï¼›</li><li><strong>äº¤äº’æç¤º</strong>ï¼šå¤ç”¨ Ant Design Vue çš„ <code>Modal.confirm</code>ï¼Œå±•ç¤ºå½“å‰/æœ€æ–°ç‰ˆæœ¬ä¸ç¯å¢ƒï¼›</li><li><strong>ç¼“å­˜ç­–ç•¥</strong>ï¼šNginx å¯¹ HTML/<code>version.json</code> ç¦æ­¢ç¼“å­˜ï¼Œå¯¹ JS/CSS/å›¾ç‰‡ç»§ç»­é•¿ç¼“å­˜ï¼›</li><li><strong>CI/CD é…åˆ</strong>ï¼šæ¨èåœ¨æ„å»ºå‘½ä»¤ä¸­ä¼ å…¥ç»Ÿä¸€æ—¶é—´æˆ³ï¼Œç¡®ä¿åŒä¸€æ„å»ºä»»åŠ¡çš„æ‰€æœ‰è¿›ç¨‹ä½¿ç”¨ç›¸åŒç‰ˆæœ¬å·ã€‚</li></ol><h2 id="_4-å…³é”®è½åœ°ç»†èŠ‚" tabindex="-1"><a class="header-anchor" href="#_4-å…³é”®è½åœ°ç»†èŠ‚"><span>4. å…³é”®è½åœ°ç»†èŠ‚</span></a></h2><h3 id="_4-1-è·¨å¹³å°æ„å»ºè„šæœ¬é…ç½®-cross-platform-build-script-configuration" tabindex="-1"><a class="header-anchor" href="#_4-1-è·¨å¹³å°æ„å»ºè„šæœ¬é…ç½®-cross-platform-build-script-configuration"><span>4.1 è·¨å¹³å°æ„å»ºè„šæœ¬é…ç½®ï¼ˆCross Platform Build Script Configurationï¼‰</span></a></h3><p>ä¸ºäº†ç¡®ä¿ Windows/Linux/macOS ç¯å¢ƒéƒ½èƒ½æ­£ç¡®è®¾ç½®æ—¶é—´æˆ³ï¼Œæˆ‘ä»¬åœ¨ <code>package.json</code> ä¸­ä½¿ç”¨ <code>cross-env</code> å’Œç‹¬ç«‹çš„æ—¶é—´æˆ³è„šæœ¬ï¼š</p><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env BUILD_TIMESTAMP=$(node scripts/get-timestamp.js) NODE_OPTIONS=--openssl-legacy-provider vue-cli-service build --mode production&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;build-develop&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env BUILD_TIMESTAMP=$(node scripts/get-timestamp.js) NODE_OPTIONS=--openssl-legacy-provider vue-cli-service build --mode develop&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;build-testing&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env BUILD_TIMESTAMP=$(node scripts/get-timestamp.js) NODE_OPTIONS=--openssl-legacy-provider vue-cli-service build --mode testing&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;build-release&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env BUILD_TIMESTAMP=$(node scripts/get-timestamp.js) NODE_OPTIONS=--openssl-legacy-provider vue-cli-service build --mode release&quot;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token comment">// scripts/get-timestamp.js</span></span>
<span class="line"><span class="token comment">// è·¨å¹³å°è·å–æ—¶é—´æˆ³</span></span>
<span class="line"><span class="token keyword">const</span> timestamp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toISOString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[-T:]</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>timestamp<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å…³é”®ç‚¹</strong>ï¼š</p><ul><li><code>cross-env</code> ç¡®ä¿ç¯å¢ƒå˜é‡åœ¨ä¸åŒæ“ä½œç³»ç»Ÿä¸‹æ­£ç¡®ä¼ é€’</li><li>ç‹¬ç«‹çš„æ—¶é—´æˆ³è„šæœ¬é¿å… shell å‘½ä»¤å…¼å®¹æ€§é—®é¢˜</li></ul><h3 id="_4-2-ç‰ˆæœ¬å·åªç”Ÿæˆä¸€æ¬¡-build-time-deterministic-versioning" tabindex="-1"><a class="header-anchor" href="#_4-2-ç‰ˆæœ¬å·åªç”Ÿæˆä¸€æ¬¡-build-time-deterministic-versioning"><span>4.2 ç‰ˆæœ¬å·åªç”Ÿæˆä¸€æ¬¡ï¼ˆBuild-time Deterministic Versioningï¼‰</span></a></h3><p>ä¸ºäº†å½»åº•è§£å†³&quot;ç‰ˆæœ¬å·æ‰“æ¶&quot;é—®é¢˜ï¼Œæˆ‘ä»¬åœ¨ <code>vue.config.js</code> ä¸­é‡‡ç”¨äº†<strong>æ¨¡å—åŠ è½½æ—¶ç¡®å®šæ—¶é—´æˆ³</strong>çš„ç­–ç•¥ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> packageJson <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./package.json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// âš ï¸ é‡è¦ï¼šåœ¨æ¨¡å—åŠ è½½æ—¶ç¡®å®šæ„å»ºæ—¶é—´æˆ³ï¼Œé¿å…å¤šè¿›ç¨‹æ„å»ºæ—¶ç‰ˆæœ¬å·ä¸ä¸€è‡´</span></span>
<span class="line"><span class="token comment">// Webpack/Vite å¤šè¿›ç¨‹æ„å»ºæ—¶ï¼Œæ¯ä¸ª worker è¿›ç¨‹ç‹¬ç«‹æ‰§è¡Œä»£ç ï¼Œå¦‚æœå¤šæ¬¡è°ƒç”¨ new Date()</span></span>
<span class="line"><span class="token comment">// å¯èƒ½åœ¨ä¸åŒè¿›ç¨‹ã€ä¸åŒæ—¶é—´ç‚¹ç”Ÿæˆä¸åŒçš„æ—¶é—´æˆ³ï¼Œå¯¼è‡´åŒä¸€æ„å»ºäº§ç‰©ç‰ˆæœ¬å·ä¸ä¸€è‡´</span></span>
<span class="line"><span class="token comment">// æ–¹æ¡ˆï¼šä¼˜å…ˆä½¿ç”¨ CI/CD ä¼ å…¥çš„ BUILD_TIMESTAMPï¼Œå¦åˆ™åœ¨æ¨¡å—åŠ è½½æ—¶ç¡®å®šç»Ÿä¸€æ—¶é—´æˆ³</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token constant">BUILD_TIMESTAMP</span> <span class="token operator">=</span></span>
<span class="line">  process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">BUILD_TIMESTAMP</span> <span class="token operator">||</span></span>
<span class="line">  <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> now <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> now<span class="token punctuation">.</span><span class="token function">toISOString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[-T:]</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// æ ¼å¼åŒ–æ—¶é—´æˆ³ï¼šå¹´æœˆæ—¥æ—¶åˆ†ï¼ˆå¦‚202310301500ï¼‰</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">getFormattedTimestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// ä½¿ç”¨æ¨¡å—åŠ è½½æ—¶ç¡®å®šçš„ç»Ÿä¸€æ—¶é—´æˆ³</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token constant">BUILD_TIMESTAMP</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// è·å–å½“å‰ç¯å¢ƒåç§°</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">getEnvName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VUE_APP_ENV</span> <span class="token operator">||</span> <span class="token string">&quot;develop&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// ç”Ÿæˆå¤åˆç‰ˆæœ¬å·ï¼šåŸºç¡€ç‰ˆæœ¬+ç¯å¢ƒ+æ—¶é—´æˆ³</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">getAppVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> baseVersion <span class="token operator">=</span> packageJson<span class="token punctuation">.</span>version<span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">const</span> envName <span class="token operator">=</span> <span class="token function">getEnvName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">const</span> timestamp <span class="token operator">=</span> <span class="token function">getFormattedTimestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>baseVersion<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>envName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>timestamp<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// âš ï¸ å…³é”®ï¼šæ„å»ºé˜¶æ®µä»…ç”Ÿæˆä¸€æ¬¡ç‰ˆæœ¬å·å’Œç¯å¢ƒæ ‡è¯†ï¼Œä¿æŒå‰ç«¯æ³¨å…¥ä¸ version.json å®Œå…¨ä¸€è‡´</span></span>
<span class="line"><span class="token keyword">const</span> buildEnvName <span class="token operator">=</span> <span class="token function">getEnvName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> buildVersion <span class="token operator">=</span> <span class="token function">getAppVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">configureWebpack</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">      <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DefinePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token string-property property">&quot;process.env.APP_VERSION&quot;</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>buildVersion<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;process.env.APP_ENV&quot;</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>buildEnvName<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token function">chainWebpack</span><span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    config<span class="token punctuation">.</span><span class="token function">plugin</span><span class="token punctuation">(</span><span class="token string">&quot;generate-version-json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">      <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>done<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">&quot;GenerateVersionJsonPlugin&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">          fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span></span>
<span class="line">            path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;edu/version.json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span></span>
<span class="line">              <span class="token punctuation">{</span></span>
<span class="line">                <span class="token literal-property property">version</span><span class="token operator">:</span> buildVersion<span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">env</span><span class="token operator">:</span> buildEnvName<span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">timestamp</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toISOString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">publicPath</span><span class="token operator">:</span> <span class="token string">&quot;/child/edu&quot;</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token keyword">null</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token number">2</span></span>
<span class="line">            <span class="token punctuation">)</span></span>
<span class="line">          <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ ¸å¿ƒæ”¹è¿›ç‚¹</strong>ï¼š</p><ol><li><strong>ä¼˜å…ˆä½¿ç”¨ CI/CD ä¼ å…¥çš„æ—¶é—´æˆ³</strong>ï¼šé€šè¿‡ <code>BUILD_TIMESTAMP</code> ç¯å¢ƒå˜é‡ï¼Œè®© Jenkins ç»Ÿä¸€ç®¡ç†ç‰ˆæœ¬å·ï¼›</li><li><strong>æ¨¡å—åŠ è½½æ—¶ç¡®å®šå…œåº•æ—¶é—´æˆ³</strong>ï¼šå¦‚æœæ²¡æœ‰ä¼ å…¥ç¯å¢ƒå˜é‡ï¼Œåœ¨æ¨¡å—åŠ è½½æ—¶ï¼ˆè€Œéå‡½æ•°è°ƒç”¨æ—¶ï¼‰ç¡®å®šæ—¶é—´æˆ³ï¼Œé¿å…å¤šè¿›ç¨‹æ„å»ºæ—¶äº§ç”Ÿä¸åŒç‰ˆæœ¬å·ï¼›</li><li><strong>å…¨å±€å¤ç”¨ç‰ˆæœ¬å·</strong>ï¼š<code>buildVersion</code> å’Œ <code>buildEnvName</code> åœ¨æ¨¡å—é¡¶å±‚ç¡®å®šåï¼Œè¢« DefinePlugin å’Œ version.json ç”Ÿæˆé€»è¾‘å…±åŒä½¿ç”¨ã€‚</li></ol><p>è¿™æ ·å³ä½¿æ„å»ºè¿‡ç¨‹æŒç»­ 5 ï½ 10 åˆ†é’Ÿï¼Œæ³¨å…¥çš„ç‰ˆæœ¬å·å’Œé™æ€æ–‡ä»¶é‡Œçš„ç‰ˆæœ¬ä»ä¿æŒä¸€è‡´ã€‚è¿™å…¶å®æ˜¯æŠŠ&quot;æ„å»ºäº§ç‰©è§†ä¸ºä¸å¯å˜å·¥ä»¶&quot;çš„åŸåˆ™è½åœ°â€”â€”ä¿è¯ä»»ä½•ä½¿ç”¨è¯¥å·¥ä»¶çš„å…¥å£çœ‹åˆ°çš„å…ƒæ•°æ®éƒ½æ˜¯åŒä¸€ä¸ªå¿«ç…§ã€‚</p><h3 id="_4-3-ç‰ˆæœ¬æ£€æŸ¥å™¨-runtime-polling-cache-busting" tabindex="-1"><a class="header-anchor" href="#_4-3-ç‰ˆæœ¬æ£€æŸ¥å™¨-runtime-polling-cache-busting"><span>4.3 ç‰ˆæœ¬æ£€æŸ¥å™¨ï¼ˆRuntime Polling &amp; Cache Bustingï¼‰</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">class</span> <span class="token class-name">VersionChecker</span> <span class="token punctuation">{</span></span>
<span class="line">  currentVersion <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">APP_VERSION</span><span class="token punctuation">;</span></span>
<span class="line">  publicPath <span class="token operator">=</span> <span class="token string">&quot;/child/edu&quot;</span><span class="token punctuation">;</span></span>
<span class="line">  checkInterval <span class="token operator">=</span> <span class="token number">30</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span></span>
<span class="line">      <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">ğŸ“Œ å½“å‰å‰ç«¯ç‰ˆæœ¬ï¼š</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentVersion<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">ï¼ˆ</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">APP_ENV</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">ï¼‰</span><span class="token template-punctuation string">\`</span></span></span>
<span class="line">    <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">startChecking</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;visibilitychange&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>visibilityState <span class="token operator">===</span> <span class="token string">&quot;visible&quot;</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>hasNotified<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">checkForUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">async</span> <span class="token function">checkForUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token keyword">this</span><span class="token punctuation">.</span>publicPath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/version.json?t=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">cache</span><span class="token operator">:</span> <span class="token string">&quot;no-store&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>response<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> latestInfo <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>latestInfo<span class="token punctuation">.</span>version <span class="token operator">!==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>currentVersion <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>hasNotified<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">this</span><span class="token punctuation">.</span>hasNotified <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">stopChecking</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">showUpdateModal</span><span class="token punctuation">(</span>latestInfo<span class="token punctuation">.</span>version<span class="token punctuation">,</span> latestInfo<span class="token punctuation">.</span>env<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œæœ‰ä¸¤ä¸ªå®¹æ˜“è¢«å¿½ç•¥çš„ç»†èŠ‚ï¼š</p><ol><li><code>fetch</code> æ˜¾å¼åŠ  <code>cache: &quot;no-store&quot;</code>ï¼Œå†å åŠ æ—¶é—´æˆ³å‚æ•°ï¼Œé˜²æ­¢ CDN / æµè§ˆå™¨ä»»ä½•ä¸€å±‚å¹²é¢„ï¼›</li><li><code>visibilitychange</code> ç›‘å¬ï¼Œä¿è¯çª—å£é‡æ–°æ¿€æ´»æ—¶ç«‹å³æ¯”å¯¹ï¼Œé¿å…ç”¨æˆ·åœ¨åå°ç­‰äº†å¾ˆä¹…æ‰çœ‹åˆ°å¼¹çª—ã€‚</li></ol><p>å…¥å£ <code>main.ts</code> åœ¨åº”ç”¨ mount ä¹‹åè°ƒç”¨ <code>versionChecker.init()</code>ï¼Œå³å¯æŠŠæ•´ä¸ªæ£€æµ‹é“¾è·¯ä¸²èµ·æ¥ã€‚</p><h3 id="_4-4-nginx-ç¼“å­˜ç­–ç•¥-precise-cache-partition" tabindex="-1"><a class="header-anchor" href="#_4-4-nginx-ç¼“å­˜ç­–ç•¥-precise-cache-partition"><span>4.4 Nginx ç¼“å­˜ç­–ç•¥ï¼ˆPrecise Cache Partitionï¼‰</span></a></h3><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code><span class="line"><span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">if</span> (<span class="token variable">$request_filename</span> ~* \\.html$)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">add_header</span> Cache-Control <span class="token string">&quot;no-store, no-cache, must-revalidate&quot;</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token directive"><span class="token keyword">location</span> /child/edu</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">if</span> (<span class="token variable">$request_filename</span> ~* \\.html$)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">add_header</span> Cache-Control <span class="token string">&quot;no-store, no-cache, must-revalidate&quot;</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token directive"><span class="token keyword">location</span> ~* /child/edu/version\\.json$</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">add_header</span> Cache-Control <span class="token string">&quot;no-store, no-cache, must-revalidate, proxy-revalidate&quot;</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">add_header</span> Pragma <span class="token string">&quot;no-cache&quot;</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">add_header</span> Expires <span class="token string">&quot;0&quot;</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">add_header</span> Surrogate-Control <span class="token string">&quot;no-store&quot;</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸€å±‚çš„æ€è·¯æ˜¯æŠŠèµ„æºåˆ†æˆä¸¤ç±»ï¼šéœ€è¦å®æ—¶æ€§ï¼ˆHTMLã€version.jsonï¼‰å°± <code>no-store</code>ï¼Œå…¶ä½™èµ°é•¿ç¼“å­˜ã€‚å†é…åˆ <code>try_files</code> å…œåº• history è·¯ç”±ï¼Œå¾®å‰ç«¯å­åº”ç”¨çš„ç‹¬ç«‹éƒ¨ç½²ä¸ä¼šäº’ç›¸å½±å“ã€‚</p><h3 id="_4-5-ci-cd-é…ç½®-zero-touch-pipeline" tabindex="-1"><a class="header-anchor" href="#_4-5-ci-cd-é…ç½®-zero-touch-pipeline"><span>4.5 CI/CD é…ç½®ï¼ˆZero-touch Pipelineï¼‰</span></a></h3><p><strong>æ¨èæ–¹æ¡ˆ</strong>ï¼šåœ¨ Jenkins æ„å»ºå‘½ä»¤ä¸­ä¼ å…¥ç»Ÿä¸€çš„æ„å»ºæ—¶é—´æˆ³ï¼Œç¡®ä¿åŒä¸€æ„å»ºä»»åŠ¡çš„æ‰€æœ‰è¿›ç¨‹ä½¿ç”¨ç›¸åŒç‰ˆæœ¬å·ï¼š</p><table><thead><tr><th>ç¯å¢ƒ</th><th>æ„å»ºå‘½ä»¤ï¼ˆæ¨èï¼‰</th><th>æ„å»ºå‘½ä»¤ï¼ˆç®€åŒ–ç‰ˆï¼‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>develop</td><td><code>BUILD_TIMESTAMP=$(date +%Y%m%d%H%M) npm install &amp;&amp; npm run build-develop</code></td><td><code>npm run build-develop</code></td><td>æ—¥å¸¸å¼€å‘éªŒè¯</td></tr><tr><td>testing</td><td><code>BUILD_TIMESTAMP=$(date +%Y%m%d%H%M) npm install &amp;&amp; npm run build-testing</code></td><td><code>npm run build-testing</code></td><td>é›†æˆæµ‹è¯•</td></tr><tr><td>release</td><td><code>BUILD_TIMESTAMP=$(date +%Y%m%d%H%M) npm install &amp;&amp; npm run build-release</code></td><td><code>npm run build-release</code></td><td>é¢„å‘å¸ƒ</td></tr><tr><td>production</td><td><code>BUILD_TIMESTAMP=$(date +%Y%m%d%H%M) npm install &amp;&amp; npm run build-production</code></td><td><code>npm run build-production</code></td><td>çº¿ä¸Š</td></tr></tbody></table><p><strong>Windows Jenkins èŠ‚ç‚¹ï¼ˆPowerShellï¼‰</strong>ï¼š</p><div class="language-powershell line-numbers-mode" data-highlighter="prismjs" data-ext="powershell"><pre><code><span class="line"><span class="token variable">$env</span>:BUILD_TIMESTAMP = <span class="token punctuation">(</span><span class="token function">Get-Date</span> <span class="token operator">-</span>Format <span class="token string">&quot;yyyyMMddHHmm&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> npm install<span class="token punctuation">;</span> npm run build-develop</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>è¯´æ˜</strong>ï¼š</p><ul><li><strong>æ¨èæ–¹æ¡ˆ</strong>ï¼šä¼ å…¥ <code>BUILD_TIMESTAMP</code> ç¯å¢ƒå˜é‡ï¼Œç”± CI/CD æµæ°´çº¿ç»Ÿä¸€ç®¡ç†æ—¶é—´æˆ³ï¼Œä¿è¯åŒä¸€æ„å»ºä»»åŠ¡ç‰ˆæœ¬å·å®Œå…¨ä¸€è‡´</li><li><strong>ç®€åŒ–æ–¹æ¡ˆ</strong>ï¼šä¸ä¼ å…¥æ—¶é—´æˆ³æ—¶ï¼Œä»£ç ä¼šåœ¨æ¨¡å—åŠ è½½æ—¶ç¡®å®šæ—¶é—´æˆ³ï¼Œåœ¨å¤šè¿›ç¨‹åœºæ™¯ä¸‹ä»å¯èƒ½å‡ºç°ç»†å¾®å·®å¼‚ï¼ˆæ¦‚ç‡è¾ƒä½ï¼‰</li><li><strong>å¦‚éœ€ç²¾ç¡®æ§åˆ¶ç‰ˆæœ¬å·ï¼Œå»ºè®®é‡‡ç”¨æ¨èæ–¹æ¡ˆ</strong></li></ul><p>æ‰€æœ‰å‘½ä»¤éƒ½å¸¦ <code>cross-env NODE_OPTIONS=--openssl-legacy-provider</code>ï¼Œä»¥å…¼å®¹ä¸åŒç³»ç»Ÿçš„ OpenSSL ç‰ˆæœ¬ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œè¿™å¥—æ–¹æ¡ˆæ²¡æœ‰&quot;è¦æ±‚è¿ç»´å¤šåšä¸€æ­¥&quot;â€”â€”æ„å»ºäº§ç‰©å¤©ç„¶æºå¸¦ version.jsonï¼Œä»»ä½•ç¯å¢ƒæ‹¿åˆ°åŒ…å³å¯ä¸Šçº¿ã€‚</p><h2 id="_5-æµ‹è¯•ä¸éªŒè¯" tabindex="-1"><a class="header-anchor" href="#_5-æµ‹è¯•ä¸éªŒè¯"><span>5. æµ‹è¯•ä¸éªŒè¯</span></a></h2><p>æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå®Œæ•´çš„å›å½’æµç¨‹ï¼Œç¡®ä¿æ–¹æ¡ˆä¸ä¼šç»™æµ‹è¯•å’Œä¸Šçº¿å¸¦æ¥é¢å¤–è´Ÿæ‹…ï¼š</p><ol><li><strong>é¦–æ¬¡è®¿é—®</strong>ï¼šæ‰“å¼€ dev ç¯å¢ƒé¡µé¢ï¼Œç¡®è®¤æ§åˆ¶å°æ‰“å°ç‰ˆæœ¬å·ï¼ŒNetwork é‡Œèƒ½çœ‹åˆ° <code>version.json</code> ä¸”å“åº”å¤´æ— ç¼“å­˜ï¼›</li><li><strong>è§¦å‘æ–°ç‰ˆæœ¬</strong>ï¼šè°ƒæ•´ä»»æ„æ–‡æ¡ˆï¼Œé‡æ–°å‘å¸ƒï¼Œä¿æŒæ—§é¡µé¢ä¸åˆ·æ–°ï¼›</li><li><strong>è½®è¯¢éªŒè¯</strong>ï¼š30 ç§’å†…å¼¹å‡ºæç¤ºæ¡†ï¼Œå±•ç¤ºå½“å‰/æœ€æ–°ç‰ˆæœ¬å’Œç¯å¢ƒï¼›</li><li><strong>äº¤äº’è·¯å¾„</strong>ï¼š <ul><li>ç‚¹å‡»&quot;ç«‹å³åˆ·æ–°&quot;ï¼šé¡µé¢å¼ºåˆ¶ reloadï¼Œæ–°ç‰ˆæœ¬ç”Ÿæ•ˆï¼›</li><li>ç‚¹å‡»&quot;ç¨ååˆ·æ–°&quot;ï¼šè®°å½•å–æ¶ˆåŠ¨ä½œå¹¶é‡æ–°å¼€å¯è½®è¯¢ï¼›</li></ul></li><li><strong>è¾¹ç•Œåœºæ™¯</strong>ï¼šåˆ‡ tab / æ¸…ç¼“å­˜ / æ–°è®¾å¤‡è®¿é—® / çŸ­æ—¶é—´è¿ç»­å‘å¸ƒï¼Œå‡èƒ½æ­£ç¡®æ„ŸçŸ¥æœ€æ–°ç‰ˆæœ¬ã€‚</li></ol><h2 id="_6-æ³¨æ„äº‹é¡¹ä¸å¸¸è§é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#_6-æ³¨æ„äº‹é¡¹ä¸å¸¸è§é—®é¢˜"><span>6. æ³¨æ„äº‹é¡¹ä¸å¸¸è§é—®é¢˜</span></a></h2><table><thead><tr><th>ç°è±¡</th><th>å¯èƒ½åŸå› </th><th>è§£å†³æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td>æ²¡æœ‰å¼¹çª—</td><td><code>version.json</code> 404 æˆ–ç‰ˆæœ¬æœªå˜</td><td>æ£€æŸ¥éƒ¨ç½²è·¯å¾„ã€ç¡®è®¤æ„å»ºæ˜¯å¦ç”Ÿæˆæ–‡ä»¶</td></tr><tr><td>å¼¹çª—ååˆ·æ–°ä»æ—§ç‰ˆæœ¬</td><td>é™æ€èµ„æºè¢«ç¼“å­˜</td><td>æ ¸å® Nginx ç¼“å­˜ç­–ç•¥ã€æŸ¥çœ‹æµè§ˆå™¨ç¼“å­˜è®¾ç½®</td></tr><tr><td>æ„å»ºå¤±è´¥</td><td><code>cross-env</code> æœªå®‰è£…æˆ–æƒé™ä¸è¶³</td><td>è¡¥å……ä¾èµ–ã€ç¡®ä¿ Jenkins å·¥ä½œç›®å½•å¯å†™</td></tr><tr><td>æŒç»­è¯¯æŠ¥æ›´æ–°</td><td>æ„å»ºé˜¶æ®µå¤šæ¬¡ç”Ÿæˆç‰ˆæœ¬å·</td><td>åœ¨ <code>vue.config.js</code> é¡¶éƒ¨ç¼“å­˜ <code>buildVersion</code> å¹¶å…¨å±€å¤ç”¨</td></tr></tbody></table><h2 id="_7-è½åœ°æˆæ•ˆ" tabindex="-1"><a class="header-anchor" href="#_7-è½åœ°æˆæ•ˆ"><span>7. è½åœ°æˆæ•ˆ</span></a></h2><ul><li>æ—§é¡µé¢ç”¨æˆ·åœ¨ 30 ç§’å†…æ”¶åˆ°æé†’ï¼Œæµ‹è¯•æ•ˆç‡æ˜¾è‘—æå‡ï¼›</li><li>&quot;å¹½çµå¼¹çª—&quot;å½»åº•æ¶ˆå¤±ï¼Œç‰ˆæœ¬å¯¹æ¯”é€»è¾‘ç¨³å®šï¼›</li><li>æ–¹æ¡ˆåªè§¦ç¢°å‰ç«¯ä¸ Nginx é…ç½®ï¼Œå‘å¸ƒæµç¨‹æ— éœ€æ”¹é€ ï¼›</li><li>æ–‡æ¡£åŒ–åï¼Œå…¶ä»–å­åº”ç”¨æ— éœ€é‡å¤æ€è€ƒï¼Œç›´æ¥å¤ç”¨ã€‚</li></ul><h2 id="_8-å±•æœ›" tabindex="-1"><a class="header-anchor" href="#_8-å±•æœ›"><span>8. å±•æœ›</span></a></h2><p>ä¸‹ä¸€æ­¥æˆ‘ä»¬è®¡åˆ’ï¼š</p><ol><li><strong>å°è£…é€šç”¨ SDK</strong>ï¼šæŠ½è±¡ç‰ˆæœ¬ç”Ÿæˆã€è½®è¯¢ã€å¼¹çª—é€»è¾‘ï¼Œæ”¯æŒ Vue CLI / Viteï¼›</li><li><strong>å¯è§†åŒ–ç‰ˆæœ¬é¢æ¿</strong>ï¼šåœ¨ä¸»åº”ç”¨æ±‡æ€»æ‰€æœ‰ç¯å¢ƒçš„ç‰ˆæœ¬å’Œå‘å¸ƒæ—¶é—´ï¼›</li><li><strong>å·®å¼‚åŒ–ç­–ç•¥</strong>ï¼šé’ˆå¯¹é«˜ä¼˜å…ˆçº§ç‰ˆæœ¬å¼ºåˆ¶åˆ·æ–°ï¼Œæ™®é€šç‰ˆæœ¬å…è®¸ç”¨æˆ·è‡ªè¡Œé€‰æ‹©ã€‚</li></ol><hr><p>è¿™æ¬¡å®è·µè®©æˆ‘å†æ¬¡æ„è¯†åˆ°ï¼šçœŸæ­£çš„å‘å¾€å¾€è—åœ¨çœ‹ä¼¼&quot;å¾®ä¸è¶³é“&quot;çš„ç»†èŠ‚é‡Œã€‚å½“æˆ‘ä»¬æŠŠé—®é¢˜å’Œæ€è€ƒå†™æˆæ–‡æ¡£ã€æ²‰æ·€æˆæ¨¡æ¿ï¼Œå›¢é˜Ÿå°±èƒ½ä»¥æ›´å°çš„ä»£ä»·è·å¾—æ›´ç¨³å®šçš„äº¤ä»˜ã€‚å¦‚æœä½ ä¹Ÿåœ¨æ¨è¿›å¾®å‰ç«¯ç‰ˆæœ¬åŒæ­¥ï¼Œæ¬¢è¿äº¤æµã€äº’ç›¸å€Ÿé‰´ã€‚</p>`,56)])])}const c=s(e,[["render",o]]),u=JSON.parse('{"path":"/%E4%BB%8E%E2%80%9C%E7%89%88%E6%9C%AC%E5%8F%B7%E6%89%93%E6%9E%B6%E2%80%9D%E5%88%B0%2030%20%E7%A7%92%E5%86%85%E6%8F%90%E9%86%92%E7%94%A8%E6%88%B7%E5%88%B7%E6%96%B0%EF%BC%9A%E4%B8%80%E4%B8%AA%E5%BE%AE%E5%89%8D%E7%AB%AF%E5%9B%A2%E9%98%9F%E7%9A%84%E5%AE%9E%E8%B7%B5.html","title":"ä»\\"ç‰ˆæœ¬å·æ‰“æ¶\\"åˆ° 30 ç§’å†…æé†’ç”¨æˆ·åˆ·æ–°ï¼šä¸€ä¸ªå¾®å‰ç«¯å›¢é˜Ÿçš„å®è·µ","lang":"zh-CN","frontmatter":{},"headers":[{"level":2,"title":"1. èƒŒæ™¯ä¸ç—›ç‚¹","slug":"_1-èƒŒæ™¯ä¸ç—›ç‚¹","link":"#_1-èƒŒæ™¯ä¸ç—›ç‚¹","children":[{"level":3,"title":"1.1 çœŸå®åœºæ™¯","slug":"_1-1-çœŸå®åœºæ™¯","link":"#_1-1-çœŸå®åœºæ™¯","children":[]},{"level":3,"title":"1.2 æˆ‘ä»¬çš„è¯‰æ±‚","slug":"_1-2-æˆ‘ä»¬çš„è¯‰æ±‚","link":"#_1-2-æˆ‘ä»¬çš„è¯‰æ±‚","children":[]}]},{"level":2,"title":"2. æ–¹æ¡ˆæ¢ç´¢ä¸å–èˆ","slug":"_2-æ–¹æ¡ˆæ¢ç´¢ä¸å–èˆ","link":"#_2-æ–¹æ¡ˆæ¢ç´¢ä¸å–èˆ","children":[]},{"level":2,"title":"3. æŠ€æœ¯æ–¹æ¡ˆæ€»è§ˆ","slug":"_3-æŠ€æœ¯æ–¹æ¡ˆæ€»è§ˆ","link":"#_3-æŠ€æœ¯æ–¹æ¡ˆæ€»è§ˆ","children":[]},{"level":2,"title":"4. å…³é”®è½åœ°ç»†èŠ‚","slug":"_4-å…³é”®è½åœ°ç»†èŠ‚","link":"#_4-å…³é”®è½åœ°ç»†èŠ‚","children":[{"level":3,"title":"4.1 è·¨å¹³å°æ„å»ºè„šæœ¬é…ç½®ï¼ˆCross Platform Build Script Configurationï¼‰","slug":"_4-1-è·¨å¹³å°æ„å»ºè„šæœ¬é…ç½®-cross-platform-build-script-configuration","link":"#_4-1-è·¨å¹³å°æ„å»ºè„šæœ¬é…ç½®-cross-platform-build-script-configuration","children":[]},{"level":3,"title":"4.2 ç‰ˆæœ¬å·åªç”Ÿæˆä¸€æ¬¡ï¼ˆBuild-time Deterministic Versioningï¼‰","slug":"_4-2-ç‰ˆæœ¬å·åªç”Ÿæˆä¸€æ¬¡-build-time-deterministic-versioning","link":"#_4-2-ç‰ˆæœ¬å·åªç”Ÿæˆä¸€æ¬¡-build-time-deterministic-versioning","children":[]},{"level":3,"title":"4.3 ç‰ˆæœ¬æ£€æŸ¥å™¨ï¼ˆRuntime Polling & Cache Bustingï¼‰","slug":"_4-3-ç‰ˆæœ¬æ£€æŸ¥å™¨-runtime-polling-cache-busting","link":"#_4-3-ç‰ˆæœ¬æ£€æŸ¥å™¨-runtime-polling-cache-busting","children":[]},{"level":3,"title":"4.4 Nginx ç¼“å­˜ç­–ç•¥ï¼ˆPrecise Cache Partitionï¼‰","slug":"_4-4-nginx-ç¼“å­˜ç­–ç•¥-precise-cache-partition","link":"#_4-4-nginx-ç¼“å­˜ç­–ç•¥-precise-cache-partition","children":[]},{"level":3,"title":"4.5 CI/CD é…ç½®ï¼ˆZero-touch Pipelineï¼‰","slug":"_4-5-ci-cd-é…ç½®-zero-touch-pipeline","link":"#_4-5-ci-cd-é…ç½®-zero-touch-pipeline","children":[]}]},{"level":2,"title":"5. æµ‹è¯•ä¸éªŒè¯","slug":"_5-æµ‹è¯•ä¸éªŒè¯","link":"#_5-æµ‹è¯•ä¸éªŒè¯","children":[]},{"level":2,"title":"6. æ³¨æ„äº‹é¡¹ä¸å¸¸è§é—®é¢˜","slug":"_6-æ³¨æ„äº‹é¡¹ä¸å¸¸è§é—®é¢˜","link":"#_6-æ³¨æ„äº‹é¡¹ä¸å¸¸è§é—®é¢˜","children":[]},{"level":2,"title":"7. è½åœ°æˆæ•ˆ","slug":"_7-è½åœ°æˆæ•ˆ","link":"#_7-è½åœ°æˆæ•ˆ","children":[]},{"level":2,"title":"8. å±•æœ›","slug":"_8-å±•æœ›","link":"#_8-å±•æœ›","children":[]}],"git":{"updatedTime":1765284822000,"contributors":[{"name":"é¹åŒ—æµ·","username":"","email":"2039575699@qq.com","commits":1}],"changelog":[{"hash":"47f017fe95e2e689f33348b7bb2b095439cfc050","time":1765284822000,"email":"2039575699@qq.com","author":"é¹åŒ—æµ·","message":"first-commit"}]},"filePathRelative":"ä»â€œç‰ˆæœ¬å·æ‰“æ¶â€åˆ° 30 ç§’å†…æé†’ç”¨æˆ·åˆ·æ–°ï¼šä¸€ä¸ªå¾®å‰ç«¯å›¢é˜Ÿçš„å®è·µ.md"}');export{c as comp,u as data};
